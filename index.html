<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CCTV Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8fafc;
            min-height: 100vh;
        }

        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }

        .login-card {
            background: white;
            border-radius: 12px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .login-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .login-logo {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, #7c3aed, #3b82f6);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
            font-size: 32px;
        }

        .login-title {
            font-size: 24px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 8px;
        }

        .login-subtitle {
            font-size: 14px;
            color: #64748b;
        }

        .demo-accounts {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid #e5e7eb;
        }

        .demo-title {
            font-size: 12px;
            font-weight: 600;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 12px;
            text-align: center;
        }

        .demo-account {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .demo-account:hover {
            background: #e2e8f0;
            border-color: #2563eb;
        }

        .demo-account-info {
            font-size: 14px;
        }

        .demo-account-role {
            font-weight: 600;
            color: #1e293b;
        }

        .demo-account-email {
            color: #64748b;
            font-size: 12px;
        }

        .demo-account-badge {
            font-size: 10px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 6px;
        }

        .admin-badge {
            background: #fee2e2;
            color: #991b1b;
        }

        .contractor-badge {
            background: #dbeafe;
            color: #1e40af;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        .top-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 56px;
            background: white;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            padding: 0 16px;
            z-index: 50;
        }

        .header-left {
            display: flex;
            align-items: center;
        }

        .menu-toggle {
            background: none;
            border: none;
            padding: 8px;
            margin-right: 12px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 18px;
        }

        .menu-toggle:hover {
            background: #f1f5f9;
        }

        .logo {
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, #7c3aed, #3b82f6);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 16px;
        }

        .header-title h1 {
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
        }

        .header-right {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
            border: 1px solid #e2e8f0;
        }

        .user-info:hover {
            background: #f1f5f9;
        }

        .user-avatar {
            width: 28px;
            height: 28px;
            background: #94a3b8;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            color: white;
        }

        .user-details {
            font-size: 14px;
            font-weight: 500;
            color: #1e293b;
        }

        .user-role-badge {
            font-size: 10px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 8px;
        }

        .logout-btn {
            background: none;
            border: none;
            color: #64748b;
            cursor: pointer;
            padding: 6px;
            border-radius: 4px;
        }

        .logout-btn:hover {
            background: #fee2e2;
            color: #dc2626;
        }

        .sidebar {
            width: 280px;
            background: white;
            border-right: 1px solid #e2e8f0;
            margin-top: 56px;
            position: fixed;
            height: calc(100vh - 56px);
            overflow-y: auto;
            transition: transform 0.3s ease;
            z-index: 40;
        }

        .sidebar.collapsed {
            transform: translateX(-100%);
        }

        .sidebar-content {
            padding: 16px 0;
        }

        .nav-section {
            margin-bottom: 24px;
        }

        .nav-section-title {
            font-size: 12px;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 0 16px 8px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            width: 100%;
            padding: 12px 16px;
            border: none;
            background: none;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            color: #475569;
        }

        .nav-item:hover {
            background: #f1f5f9;
            color: #1e293b;
        }

        .nav-item.active {
            background: #eff6ff;
            color: #2563eb;
            border-right: 3px solid #2563eb;
        }

        .nav-icon {
            margin-right: 12px;
            width: 18px;
            height: 18px;
            font-size: 16px;
            text-align: center;
        }

        .nav-badge {
            margin-left: auto;
            background: #e2e8f0;
            color: #64748b;
            font-size: 11px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 10px;
        }

        .nav-badge.urgent {
            background: #fee2e2;
            color: #dc2626;
        }

        .nav-badge.success {
            background: #dcfce7;
            color: #166534;
        }

        .main-content {
            flex: 1;
            margin-left: 280px;
            margin-top: 56px;
            transition: margin-left 0.3s ease;
        }

        .main-content.expanded {
            margin-left: 0;
        }

        .content-header {
            background: white;
            border-bottom: 1px solid #e2e8f0;
            padding: 20px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .content-title {
            font-size: 24px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 4px;
        }

        .content-subtitle {
            font-size: 14px;
            color: #64748b;
        }

        .content-actions {
            display: flex;
            gap: 12px;
        }

        .action-button {
            padding: 8px 16px;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-button:hover {
            background: #f9fafb;
        }

        .action-button.primary {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }

        .action-button.primary:hover {
            background: #1d4ed8;
        }

        .content-body {
            padding: 24px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px -8px rgba(0, 0, 0, 0.1);
        }

        .stat-number {
            font-size: 36px;
            font-weight: 800;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 14px;
            color: #64748b;
            font-weight: 500;
        }

        .stat-blue .stat-number { color: #2563eb; }
        .stat-green .stat-number { color: #059669; }
        .stat-red .stat-number { color: #dc2626; }
        .stat-orange .stat-number { color: #ea580c; }

        .cameras-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: 20px;
        }

        .camera-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.2s;
        }

        .camera-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px -8px rgba(0, 0, 0, 0.1);
        }

        .camera-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .camera-info {
            flex: 1;
        }

        .camera-title {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .camera-title h3 {
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
            margin-left: 8px;
        }

        .camera-location {
            display: flex;
            align-items: center;
            font-size: 13px;
            color: #64748b;
            margin-bottom: 12px;
        }

        .camera-badges {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge-checked {
            background: #dcfce7;
            color: #166534;
        }

        .badge-overdue {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge-due-soon {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-recent {
            background: #dcfce7;
            color: #166534;
        }

        .badge-retired {
            background: #f3f4f6;
            color: #6b7280;
        }

        .badge-priority {
            border: 1px solid;
        }

        .badge-high {
            background: #fee2e2;
            color: #b91c1c;
            border-color: #fecaca;
        }

        .badge-medium {
            background: #fed7aa;
            color: #c2410c;
            border-color: #fdba74;
        }

        .badge-low {
            background: #f3f4f6;
            color: #374151;
            border-color: #d1d5db;
        }

        .camera-details {
            font-size: 13px;
            margin-bottom: 16px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .detail-label {
            color: #64748b;
        }

        .detail-value {
            color: #1e293b;
            font-weight: 500;
        }

        .detail-value.overdue {
            color: #dc2626;
        }

        .previous-notes {
            background: #f8fafc;
            padding: 12px;
            border-radius: 8px;
            font-size: 12px;
            color: #64748b;
            margin-top: 8px;
            border-left: 3px solid #e2e8f0;
        }

        .check-button {
            width: 100%;
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 8px;
        }

        .check-button.enabled {
            background: #2563eb;
            color: white;
        }

        .check-button.enabled:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
        }

        .check-button.disabled {
            background: #f1f5f9;
            color: #94a3b8;
            cursor: not-allowed;
        }

        .admin-actions {
            display: flex;
            gap: 8px;
        }

        .admin-btn {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .admin-btn:hover {
            background: #f9fafb;
        }

        .admin-btn.edit {
            border-color: #2563eb;
            color: #2563eb;
        }

        .admin-btn.retire {
            border-color: #dc2626;
            color: #dc2626;
        }

        .data-table {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
        }

        .table-header {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: 18px;
            font-weight: 600;
            color: #1e293b;
        }

        .search-box {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            width: 300px;
        }

        .search-box:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            text-align: left;
            padding: 12px 16px;
            border-bottom: 1px solid #f1f5f9;
        }

        th {
            background: #f8fafc;
            font-weight: 600;
            color: #374151;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        td {
            font-size: 14px;
            color: #1e293b;
        }

        tr:hover {
            background: #f8fafc;
        }

        .table-actions {
            display: flex;
            gap: 8px;
        }

        .table-action-btn {
            padding: 4px 8px;
            border: none;
            background: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .table-action-btn:hover {
            background: #f3f4f6;
        }

        .table-action-btn.edit {
            color: #2563eb;
        }

        .table-action-btn.retire {
            color: #dc2626;
        }

        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
            z-index: 100;
        }

        .modal.hidden {
            display: none;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            width: 100%;
            max-width: 600px;
            padding: 24px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e2e8f0;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 4px;
        }

        .modal-subtitle {
            font-size: 14px;
            color: #64748b;
        }

        .form-section {
            margin-bottom: 24px;
        }

        .form-section h4 {
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 12px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-radius: 8px;
            transition: background-color 0.2s;
            border: 1px solid #e2e8f0;
        }

        .checkbox-item:hover {
            background: #f8fafc;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-right: 12px;
            accent-color: #2563eb;
        }

        .checkbox-item label {
            font-size: 14px;
            color: #1e293b;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-select {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            background: white;
        }

        .form-select:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            resize: vertical;
            font-family: inherit;
        }

        .form-textarea:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
        }

        .modal-button {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-button.primary {
            background: #2563eb;
            color: white;
        }

        .modal-button.primary:hover:not(:disabled) {
            background: #1d4ed8;
        }

        .modal-button.primary:disabled {
            background: #d1d5db;
            cursor: not-allowed;
        }

        .modal-button.success {
            background: #059669;
            color: white;
        }

        .modal-button.success:hover:not(:disabled) {
            background: #047857;
        }

        .modal-button.danger {
            background: #dc2626;
            color: white;
        }

        .modal-button.danger:hover {
            background: #b91c1c;
        }

        .modal-button.secondary {
            background: #f1f5f9;
            color: #475569;
            border: 1px solid #e2e8f0;
        }

        .modal-button.secondary:hover {
            background: #e2e8f0;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .content-header {
                padding: 16px;
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .content-body {
                padding: 16px;
            }

            .cameras-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .modal-content {
                margin: 8px;
                padding: 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="login-page">
        <div class="login-container">
            <div class="login-card">
                <div class="login-header">
                    <div class="login-logo">üì∑</div>
                    <h1 class="login-title">CCTV Management</h1>
                    <p class="login-subtitle">Sign in to your account</p>
                </div>

                <div class="demo-accounts">
                    <div class="demo-title">Demo Accounts - Click to Login</div>
                    <div class="demo-account" onclick="loginAs('admin')">
                        <div class="demo-account-info">
                            <div class="demo-account-role">Site Manager</div>
                            <div class="demo-account-email">admin@site.com</div>
                        </div>
                        <span class="demo-account-badge admin-badge">ADMIN</span>
                    </div>
                    <div class="demo-account" onclick="loginAs('contractor')">
                        <div class="demo-account-info">
                            <div class="demo-account-role">Field Contractor</div>
                            <div class="demo-account-email">john@securetech.com</div>
                        </div>
                        <span class="demo-account-badge contractor-badge">CONTRACTOR</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="main-app" class="hidden">
        <!-- Top Header -->
        <div class="top-header">
            <div class="header-left">
                <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
                <div class="logo">üì∑</div>
                <div class="header-title">
                    <h1 id="app-title">CCTV Management</h1>
                </div>
            </div>
            <div class="header-right">
                <div class="user-info">
                    <div class="user-details" id="current-user-name">John Smith</div>
                    <span class="user-role-badge contractor-badge" id="current-user-role">CONTRACTOR</span>
                    <div class="user-avatar" id="current-user-avatar">JS</div>
                    <button class="logout-btn" onclick="logout()" title="Sign Out">üö™</button>
                </div>
            </div>
        </div>

        <div class="app-container">
            <!-- Sidebar -->
            <div class="sidebar" id="sidebar">
                <div class="sidebar-content">
                    <!-- Contractor Navigation -->
                    <div id="contractor-nav">
                        <div class="nav-section">
                            <div class="nav-section-title">Camera Management</div>
                            <button class="nav-item active" onclick="navigateTo('dashboard')">
                                <span class="nav-icon">üìä</span>
                                Dashboard
                            </button>
                            <button class="nav-item" onclick="navigateTo('my-cameras')">
                                <span class="nav-icon">üì∑</span>
                                My Cameras
                                <span class="nav-badge" id="nav-assigned-count">3</span>
                            </button>
                            <button class="nav-item" onclick="navigateTo('overdue')">
                                <span class="nav-icon">‚ö†Ô∏è</span>
                                Overdue Checks
                                <span class="nav-badge urgent" id="nav-overdue-count">2</span>
                            </button>
                            <button class="nav-item" onclick="navigateTo('completed')">
                                <span class="nav-icon">‚úÖ</span>
                                Today's Checks
                                <span class="nav-badge success" id="nav-completed-count">0</span>
                            </button>
                        </div>

                        <div class="nav-section">
                            <div class="nav-section-title">Reports</div>
                            <button class="nav-item" onclick="navigateTo('history')">
                                <span class="nav-icon">üìú</span>
                                Check History
                            </button>
                        </div>
                    </div>

                    <!-- Admin Navigation -->
                    <div id="admin-nav" class="hidden">
                        <div class="nav-section">
                            <div class="nav-section-title">Dashboard</div>
                            <button class="nav-item active" onclick="navigateTo('admin-dashboard')">
                                <span class="nav-icon">üìä</span>
                                Overview
                            </button>
                            <button class="nav-item" onclick="navigateTo('analytics')">
                                <span class="nav-icon">üìà</span>
                                Analytics
                            </button>
                        </div>

                        <div class="nav-section">
                            <div class="nav-section-title">Asset Management</div>
                            <button class="nav-item" onclick="navigateTo('camera-management')">
                                <span class="nav-icon">üì∑</span>
                                Camera Management
                                <span class="nav-badge" id="nav-total-cameras">8</span>
                            </button>
                            <button class="nav-item" onclick="navigateTo('all-cameras')">
                                <span class="nav-icon">üóÇÔ∏è</span>
                                All Cameras List
                            </button>
                            <button class="nav-item" onclick="navigateTo('locations')">
                                <span class="nav-icon">üìç</span>
                                Locations
                            </button>
                            <button class="nav-item" onclick="navigateTo('freshservice-sync')">
                                <span class="nav-icon">üîÑ</span>
                                Freshservice Sync
                            </button>
                        </div>

                        <div class="nav-section">
                            <div class="nav-section-title">User Management</div>
                            <button class="nav-item" onclick="navigateTo('users')">
                                <span class="nav-icon">üë•</span>
                                All Users
                                <span class="nav-badge" id="nav-total-users">5</span>
                            </button>
                            <button class="nav-item" onclick="navigateTo('permissions')">
                                <span class="nav-icon">üõ°Ô∏è</span>
                                Permissions
                            </button>
                        </div>

                        <div class="nav-section">
                            <div class="nav-section-title">Reports</div>
                            <button class="nav-item" onclick="navigateTo('all-checks')">
                                <span class="nav-icon">üìã</span>
                                All Check Reports
                            </button>
                            <button class="nav-item" onclick="navigateTo('issues')">
                                <span class="nav-icon">‚ö†Ô∏è</span>
                                Issue Tracking
                            </button>
                        </div>

                        <div class="nav-section">
                            <div class="nav-section-title">System</div>
                            <button class="nav-item" onclick="navigateTo('settings')">
                                <span class="nav-icon">‚öôÔ∏è</span>
                                Settings
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="main-content" id="main-content">
                
                <!-- Contractor Dashboard -->
                <div id="dashboard-page">
                    <div class="content-header">
                        <div>
                            <h1 class="content-title">Dashboard</h1>
                            <p class="content-subtitle">Overview of your camera assignments</p>
                        </div>
                    </div>
                    <div class="content-body">
                        <div class="stats-grid">
                            <div class="stat-card stat-blue">
                                <div class="stat-number" id="stat-assigned">3</div>
                                <div class="stat-label">Assigned Cameras</div>
                            </div>
                            <div class="stat-card stat-green">
                                <div class="stat-number" id="stat-checked">0</div>
                                <div class="stat-label">Checked Today</div>
                            </div>
                            <div class="stat-card stat-red">
                                <div class="stat-number" id="stat-overdue">2</div>
                                <div class="stat-label">Overdue Checks</div>
                            </div>
                        </div>
                        
                        <div class="cameras-grid" id="cameras-grid"></div>
                    </div>
                </div>

                <!-- Admin Dashboard -->
                <div id="admin-dashboard-page" class="hidden">
                    <div class="content-header">
                        <div>
                            <h1 class="content-title">Admin Dashboard</h1>
                            <p class="content-subtitle">System overview and management</p>
                        </div>
                    </div>
                    <div class="content-body">
                        <div class="stats-grid">
                            <div class="stat-card stat-blue">
                                <div class="stat-number" id="admin-stat-cameras">8</div>
                                <div class="stat-label">Total Cameras</div>
                            </div>
                            <div class="stat-card stat-green">
                                <div class="stat-number" id="admin-stat-active">6</div>
                                <div class="stat-label">Active Cameras</div>
                            </div>
                            <div class="stat-card stat-red">
                                <div class="stat-number" id="admin-stat-overdue">3</div>
                                <div class="stat-label">Overdue Checks</div>
                            </div>
                            <div class="stat-card stat-orange">
                                <div class="stat-number" id="admin-stat-retired">2</div>
                                <div class="stat-label">Retired Cameras</div>
                            </div>
                        </div>
                        
                        <div class="cameras-grid" id="admin-cameras-grid"></div>
                    </div>
                </div>

                <!-- Camera Management (Admin) -->
                <div id="camera-management-page" class="hidden">
                    <div class="content-header">
                        <div>
                            <h1 class="content-title">Camera Management</h1>
                            <p class="content-subtitle">Manage all camera assets with full edit capabilities</p>
                        </div>
                        <div class="content-actions">
                            <button class="action-button" onclick="syncWithFreshservice()">
                                <span>üîÑ</span>
                                Sync with Freshservice
                            </button>
                            <button class="action-button primary" onclick="addNewCamera()">
                                <span>‚ûï</span>
                                Add Camera
                            </button>
                        </div>
                    </div>
                    <div class="content-body">
                        <div class="cameras-grid" id="camera-management-grid"></div>
                    </div>
                </div>

                <!-- All Cameras List (Admin Table View) -->
                <div id="all-cameras-page" class="hidden">
                    <div class="content-header">
                        <div>
                            <h1 class="content-title">All Cameras List</h1>
                            <p class="content-subtitle">Complete camera inventory with technical details</p>
                        </div>
                        <div class="content-actions">
                            <button class="action-button" onclick="exportCameraData()">
                                <span>üìä</span>
                                Export Data
                            </button>
                            <button class="action-button primary" onclick="addNewCamera()">
                                <span>‚ûï</span>
                                Add Camera
                            </button>
                        </div>
                    </div>
                    <div class="content-body">
                        <div class="data-table">
                            <div class="table-header">
                                <h3 class="table-title">Camera Inventory</h3>
                                <input type="text" class="search-box" placeholder="Search cameras..." id="camera-search" onkeyup="filterCameraTable()">
                            </div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Location</th>
                                        <th>Serial Number</th>
                                        <th>IP Address</th>
                                        <th>Assigned To</th>
                                        <th>Status</th>
                                        <th>Last Check</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="cameras-table-body">
                                    <!-- Populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- My Cameras Page -->
                <div id="my-cameras-page" class="hidden">
                    <div class="content-header">
                        <div>
                            <h1 class="content-title">My Cameras</h1>
                            <p class="content-subtitle">Cameras assigned to you</p>
                        </div>
                    </div>
                    <div class="content-body">
                        <div id="my-cameras-grid" class="cameras-grid"></div>
                    </div>
                </div>

                <!-- Overdue Page -->
                <div id="overdue-page" class="hidden">
                    <div class="content-header">
                        <div>
                            <h1 class="content-title">Overdue Checks</h1>
                            <p class="content-subtitle">Cameras that need immediate attention</p>
                        </div>
                    </div>
                    <div class="content-body">
                        <div id="overdue-grid" class="cameras-grid"></div>
                    </div>
                </div>

                <!-- Completed Checks Page -->
                <div id="completed-page" class="hidden">
                    <div class="content-header">
                        <div>
                            <h1 class="content-title">Today's Checks</h1>
                            <p class="content-subtitle">Cameras checked today</p>
                        </div>
                    </div>
                    <div class="content-body">
                        <div id="completed-grid" class="cameras-grid"></div>
                    </div>
                </div>

                <!-- Users Page -->
                <div id="users-page" class="hidden">
                    <div class="content-header">
                        <div>
                            <h1 class="content-title">User Management</h1>
                            <p class="content-subtitle">Manage users and permissions</p>
                        </div>
                        <div class="content-actions">
                            <button class="action-button primary" onclick="addNewUser()">
                                <span>üë§</span>
                                Add User
                            </button>
                        </div>
                    </div>
                    <div class="content-body">
                        <div class="data-table">
                            <div class="table-header">
                                <h3 class="table-title">System Users</h3>
                                <input type="text" class="search-box" placeholder="Search users..." id="user-search" onkeyup="filterUserTable()">
                            </div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Role</th>
                                        <th>Company</th>
                                        <th>Status</th>
                                        <th>Last Login</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="users-table-body">
                                    <!-- Populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Permissions Page -->
                <div id="permissions-page" class="hidden">
                    <div class="content-header">
                        <div>
                            <h1 class="content-title">Permissions Management</h1>
                            <p class="content-subtitle">Configure user roles and permissions</p>
                        </div>
                    </div>
                    <div class="content-body">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div style="font-size: 20px; font-weight: 600; color: #2563eb; margin-bottom: 8px;">Admin</div>
                                <div style="font-size: 14px; color: #64748b;">Full system access</div>
                            </div>
                            <div class="stat-card">
                                <div style="font-size: 20px; font-weight: 600; color: #059669; margin-bottom: 8px;">Manager</div>
                                <div style="font-size: 14px; color: #64748b;">Site oversight</div>
                            </div>
                            <div class="stat-card">
                                <div style="font-size: 20px; font-weight: 600; color: #ea580c; margin-bottom: 8px;">Contractor</div>
                                <div style="font-size: 14px; color: #64748b;">Assigned cameras only</div>
                            </div>
                        </div>

                        <div style="background: white; border: 1px solid #e2e8f0; border-radius: 12px; padding: 24px;">
                            <h3 style="font-size: 18px; font-weight: 600; color: #1e293b; margin-bottom: 20px;">Role Permissions Matrix</h3>
                            
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: #f8fafc;">
                                        <th style="padding: 12px 16px; text-align: left; font-weight: 600; color: #374151;">Permission</th>
                                        <th style="padding: 12px 16px; text-align: center; font-weight: 600; color: #374151;">Admin</th>
                                        <th style="padding: 12px 16px; text-align: center; font-weight: 600; color: #374151;">Manager</th>
                                        <th style="padding: 12px 16px; text-align: center; font-weight: 600; color: #374151;">Contractor</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr style="border-bottom: 1px solid #f1f5f9;">
                                        <td style="padding: 12px 16px; font-size: 14px;">View all cameras</td>
                                        <td style="padding: 12px 16px; text-align: center; color: #059669; font-size: 18px;">‚úÖ</td>
                                        <td style="padding: 12px 16px; text-align: center; color: #059669; font-size: 18px;">‚úÖ</td>
                                        <td style="padding: 12px 16px; text-align: center; color: #dc2626; font-size: 18px;">‚ùå</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #f1f5f9;">
                                        <td style="padding: 12px 16px; font-size: 14px;">Perform camera checks</td>
                                        <td style="padding: 12px 16px; text-align: center; color: #059669; font-size: 18px;">‚úÖ</td>
                                        <td style="padding: 12px 16px; text-align: center; color: #f59e0b; font-size: 18px;">‚ö†Ô∏è</td>
                                        <td style="padding: 12px 16px; text-align: center; color: #059669; font-size: 18px;">‚úÖ</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #f1f5f9;">
                                        <td style="padding: 12px 16px; font-size: 14px;">Edit camera details</td>
                                        <td style="padding: 12px 16px; text-align: center; color: #059669; font-size: 18px;">‚úÖ</td>
                                        <td style="padding: 12px 16px; text-align: center; color: #f59e0b; font-size: 18px;">‚ö†Ô∏è</td>
                                        <td style="padding: 12px 16px; text-align: center; color: #dc2626; font-size: 18px;">‚ùå</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #f1f5f9;">
                                        <td style="padding: 12px 16px; font-size: 14px;">Retire cameras</td>
                                        <td style="padding: 12px 16px; text-align: center; color: #059669; font-size: 18px;">‚úÖ</td>
                                        <td style="padding: 12px 16px; text-align: center; color: #dc2626; font-size: 18px;">‚ùå</td>
                                        <td style="padding: 12px 16px; text-align: center; color: #dc2626; font-size: 18px;">‚ùå</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #f1f5f9;">
                                        <td style="padding: 12px 16px; font-size: 14px;">Manage users</td>
                                        <td style="padding: 12px 16px; text-align: center; color: #059669; font-size: 18px;">‚úÖ</td>
                                        <td style="padding: 12px 16px; text-align: center; color: #dc2626; font-size: 18px;">‚ùå</td>
                                        <td style="padding: 12px 16px; text-align: center; color: #dc2626; font-size: 18px;">‚ùå</td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 12px 16px; font-size: 14px;">System settings</td>
                                        <td style="padding: 12px 16px; text-align: center; color: #059669; font-size: 18px;">‚úÖ</td>
                                        <td style="padding: 12px 16px; text-align: center; color: #dc2626; font-size: 18px;">‚ùå</td>
                                        <td style="padding: 12px 16px; text-align: center; color: #dc2626; font-size: 18px;">‚ùå</td>
                                    </tr>
                                </tbody>
                            </table>

                            <div style="margin-top: 20px; padding: 16px; background: #f8fafc; border-radius: 8px; border-left: 4px solid #2563eb;">
                                <h4 style="font-size: 14px; font-weight: 600; color: #1e293b; margin-bottom: 8px;">Permission Legend:</h4>
                                <div style="font-size: 13px; color: #64748b; line-height: 1.5;">
                                    <div>‚úÖ Full access</div>
                                    <div>‚ö†Ô∏è Limited access (own assignments/sites only)</div>
                                    <div>‚ùå No access</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Issues Tracking Page -->
                <div id="issues-page" class="hidden">
                    <div class="content-header">
                        <div>
                            <h1 class="content-title">Issue Tracking</h1>
                            <p class="content-subtitle">Track and manage camera issues</p>
                        </div>
                    </div>
                    <div class="content-body">
                        <div class="stats-grid">
                            <div class="stat-card stat-red">
                                <div class="stat-number">5</div>
                                <div class="stat-label">Open Issues</div>
                            </div>
                            <div class="stat-card stat-orange">
                                <div class="stat-number">12</div>
                                <div class="stat-label">In Progress</div>
                            </div>
                            <div class="stat-card stat-green">
                                <div class="stat-number">43</div>
                                <div class="stat-label">Resolved This Month</div>
                            </div>
                        </div>

                        <div class="data-table">
                            <div class="table-header">
                                <h3 class="table-title">Recent Issues</h3>
                                <input type="text" class="search-box" placeholder="Search issues..." id="issues-search">
                            </div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Issue ID</th>
                                        <th>Camera</th>
                                        <th>Type</th>
                                        <th>Priority</th>
                                        <th>Status</th>
                                        <th>Reported Date</th>
                                        <th>Assigned To</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td style="font-weight: 500;">#ISS-001</td>
                                        <td>Front Entrance Camera</td>
                                        <td>Lens Obstruction</td>
                                        <td><span class="badge badge-high">HIGH</span></td>
                                        <td><span class="badge badge-overdue">OPEN</span></td>
                                        <td>04/06/2025</td>
                                        <td>John Smith</td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: 500;">#ISS-002</td>
                                        <td>Parking Lot Camera A</td>
                                        <td>Connection Issues</td>
                                        <td><span class="badge badge-medium">MEDIUM</span></td>
                                        <td><span class="badge badge-due-soon">IN PROGRESS</span></td>
                                        <td>03/06/2025</td>
                                        <td>Mike Johnson</td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: 500;">#ISS-003</td>
                                        <td>Emergency Exit Camera</td>
                                        <td>Power Supply</td>
                                        <td><span class="badge badge-high">HIGH</span></td>
                                        <td><span class="badge badge-checked">RESOLVED</span></td>
                                        <td>02/06/2025</td>
                                        <td>Sarah Wilson</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- All Check Reports Page -->
                <div id="all-checks-page" class="hidden">
                    <div class="content-header">
                        <div>
                            <h1 class="content-title">All Check Reports</h1>
                            <p class="content-subtitle">Complete history of camera inspections</p>
                        </div>
                        <div class="content-actions">
                            <button class="action-button" onclick="exportCheckReports()">
                                <span>üìä</span>
                                Export Reports
                            </button>
                        </div>
                    </div>
                    <div class="content-body">
                        <div class="stats-grid">
                            <div class="stat-card stat-blue">
                                <div class="stat-number">156</div>
                                <div class="stat-label">Total Checks This Month</div>
                            </div>
                            <div class="stat-card stat-green">
                                <div class="stat-number">89%</div>
                                <div class="stat-label">Pass Rate</div>
                            </div>
                            <div class="stat-card stat-orange">
                                <div class="stat-number">17</div>
                                <div class="stat-label">Issues Found</div>
                            </div>
                            <div class="stat-card stat-red">
                                <div class="stat-number">2.3</div>
                                <div class="stat-label">Avg Days Overdue</div>
                            </div>
                        </div>

                        <div class="data-table">
                            <div class="table-header">
                                <h3 class="table-title">Check Reports</h3>
                                <input type="text" class="search-box" placeholder="Search reports..." id="reports-search">
                            </div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Camera</th>
                                        <th>Inspector</th>
                                        <th>Status</th>
                                        <th>Issues</th>
                                        <th>Notes</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>04/06/2025</td>
                                        <td style="font-weight: 500;">Reception Area Camera</td>
                                        <td>Sarah Wilson</td>
                                        <td><span class="badge badge-checked">PASS</span></td>
                                        <td><span style="color: #059669;">None</span></td>
                                        <td>Functioning normally</td>
                                        <td>
                                            <button class="table-action-btn" title="View Details">üëÅÔ∏è</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>03/06/2025</td>
                                        <td style="font-weight: 500;">Loading Bay Camera</td>
                                        <td>John Smith</td>
                                        <td><span class="badge badge-checked">PASS</span></td>
                                        <td><span style="color: #059669;">None</span></td>
                                        <td>Clear view, good condition</td>
                                        <td>
                                            <button class="table-action-btn" title="View Details">üëÅÔ∏è</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>02/06/2025</td>
                                        <td style="font-weight: 500;">Front Entrance Camera</td>
                                        <td>John Smith</td>
                                        <td><span class="badge badge-overdue">ISSUES</span></td>
                                        <td><span style="color: #dc2626;">Lens dirty</span></td>
                                        <td>ISSUES: Lens requires cleaning</td>
                                        <td>
                                            <button class="table-action-btn" title="View Details">üëÅÔ∏è</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>01/06/2025</td>
                                        <td style="font-weight: 500;">Warehouse Camera 1</td>
                                        <td>Mike Johnson</td>
                                        <td><span class="badge badge-checked">PASS</span></td>
                                        <td><span style="color: #059669;">None</span></td>
                                        <td>Working well, good coverage</td>
                                        <td>
                                            <button class="table-action-btn" title="View Details">üëÅÔ∏è</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- History Page (for contractors) -->
                <div id="history-page" class="hidden">
                    <div class="content-header">
                        <div>
                            <h1 class="content-title">Check History</h1>
                            <p class="content-subtitle">Your recent inspection history</p>
                        </div>
                    </div>
                    <div class="content-body">
                        <div class="stats-grid">
                            <div class="stat-card stat-blue">
                                <div class="stat-number">23</div>
                                <div class="stat-label">Checks This Month</div>
                            </div>
                            <div class="stat-card stat-green">
                                <div class="stat-number">95%</div>
                                <div class="stat-label">Pass Rate</div>
                            </div>
                            <div class="stat-card stat-orange">
                                <div class="stat-number">2</div>
                                <div class="stat-label">Issues Found</div>
                            </div>
                        </div>

                        <div class="data-table">
                            <div class="table-header">
                                <h3 class="table-title">My Check History</h3>
                                <input type="text" class="search-box" placeholder="Search history..." id="history-search">
                            </div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Camera</th>
                                        <th>Status</th>
                                        <th>Issues</th>
                                        <th>Notes</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>02/06/2025</td>
                                        <td style="font-weight: 500;">Loading Bay Camera</td>
                                        <td><span class="badge badge-checked">PASS</span></td>
                                        <td><span style="color: #059669;">None</span></td>
                                        <td>Clear view, good condition</td>
                                    </tr>
                                    <tr>
                                        <td>01/06/2025</td>
                                        <td style="font-weight: 500;">Front Entrance Camera</td>
                                        <td><span class="badge badge-overdue">ISSUES</span></td>
                                        <td><span style="color: #dc2626;">Lens dirty</span></td>
                                        <td>ISSUES: Lens requires cleaning</td>
                                    </tr>
                                    <tr>
                                        <td>30/05/2025</td>
                                        <td style="font-weight: 500;">Parking Lot Camera A</td>
                                        <td><span class="badge badge-checked">PASS</span></td>
                                        <td><span style="color: #059669;">None</span></td>
                                        <td>Check completed - no issues reported</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Placeholder pages for other nav items -->
                <div id="analytics-page" class="hidden">
                    <div class="content-header">
                        <div>
                            <h1 class="content-title">Analytics</h1>
                            <p class="content-subtitle">System performance analytics</p>
                        </div>
                    </div>
                    <div class="content-body">
                        <div style="text-align: center; padding: 60px 20px; color: #64748b;">
                            <span style="font-size: 48px;">üìà</span>
                            <h3 style="margin: 20px 0; color: #1e293b;">Analytics Dashboard</h3>
                            <p>Detailed analytics and reporting features coming soon...</p>
                        </div>
                    </div>
                </div>

                <div id="locations-page" class="hidden">
                    <div class="content-header">
                        <div>
                            <h1 class="content-title">Locations</h1>
                            <p class="content-subtitle">Manage camera locations</p>
                        </div>
                    </div>
                    <div class="content-body">
                        <div style="text-align: center; padding: 60px 20px; color: #64748b;">
                            <span style="font-size: 48px;">üìç</span>
                            <h3 style="margin: 20px 0; color: #1e293b;">Location Management</h3>
                            <p>Location mapping and management features coming soon...</p>
                        </div>
                    </div>
                </div>

                <div id="freshservice-sync-page" class="hidden">
                    <div class="content-header">
                        <div>
                            <h1 class="content-title">Freshservice Sync</h1>
                            <p class="content-subtitle">Integrate with Freshservice ITSM</p>
                        </div>
                    </div>
                    <div class="content-body">
                        <div style="text-align: center; padding: 60px 20px; color: #64748b;">
                            <span style="font-size: 48px;">üîÑ</span>
                            <h3 style="margin: 20px 0; color: #1e293b;">Freshservice Integration</h3>
                            <p>Advanced sync features and configuration options coming soon...</p>
                        </div>
                    </div>
                </div>

                <div id="settings-page" class="hidden">
                    <div class="content-header">
                        <div>
                            <h1 class="content-title">Settings</h1>
                            <p class="content-subtitle">System configuration</p>
                        </div>
                    </div>
                    <div class="content-body">
                        <div style="text-align: center; padding: 60px 20px; color: #64748b;">
                            <span style="font-size: 48px;">‚öôÔ∏è</span>
                            <h3 style="margin: 20px 0; color: #1e293b;">System Settings</h3>
                            <p>Configuration and settings panel coming soon...</p>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
                    

    <!-- Camera Edit Modal -->
    <div class="modal hidden" id="camera-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="camera-modal-title">Edit Camera</h3>
                <p class="modal-subtitle">Camera asset information</p>
            </div>

            <form id="camera-form">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="camera-name">Camera Name *</label>
                        <input type="text" id="camera-name" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="camera-asset-tag">Asset Tag</label>
                        <input type="text" id="camera-asset-tag" class="form-input">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="camera-location">Location *</label>
                        <input type="text" id="camera-location" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="camera-serial">Serial Number</label>
                        <input type="text" id="camera-serial" class="form-input">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="camera-ip">IP Address</label>
                        <input type="text" id="camera-ip" class="form-input" placeholder="192.168.1.100">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="camera-model">Model</label>
                        <input type="text" id="camera-model" class="form-input">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="camera-assigned">Assigned To</label>
                        <select id="camera-assigned" class="form-select">
                            <option value="">Select contractor...</option>
                            <option value="John Smith">John Smith</option>
                            <option value="Mike Johnson">Mike Johnson</option>
                            <option value="Sarah Wilson">Sarah Wilson</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="camera-priority">Priority</label>
                        <select id="camera-priority" class="form-select">
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="camera-notes">Installation Notes</label>
                    <textarea id="camera-notes" class="form-textarea" rows="3" placeholder="Installation notes, special instructions..."></textarea>
                </div>

                <input type="hidden" id="camera-id">
                <input type="hidden" id="freshservice-id">
            </form>

            <div class="modal-actions">
                <button type="button" class="modal-button primary" onclick="saveCamera()">
                    Save Camera
                </button>
                <button type="button" class="modal-button secondary" onclick="closeModal('camera-modal')">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- User Modal -->
    <div class="modal hidden" id="user-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="user-modal-title">Add New User</h3>
                <p class="modal-subtitle">User account information</p>
            </div>

            <form id="user-form">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="user-name">Full Name *</label>
                        <input type="text" id="user-name" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="user-email">Email *</label>
                        <input type="email" id="user-email" class="form-input" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="user-role">Role *</label>
                        <select id="user-role" class="form-select" required>
                            <option value="">Select role...</option>
                            <option value="contractor">Contractor</option>
                            <option value="manager">Site Manager</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="user-company">Company</label>
                        <input type="text" id="user-company" class="form-input">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="user-phone">Phone</label>
                        <input type="tel" id="user-phone" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="user-status">Status</label>
                        <select id="user-status" class="form-select">
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                            <option value="pending">Pending</option>
                        </select>
                    </div>
                </div>

                <input type="hidden" id="user-id">
            </form>

            <div class="modal-actions">
                <button type="button" class="modal-button primary" onclick="saveUser()">
                    Save User
                </button>
                <button type="button" class="modal-button secondary" onclick="closeModal('user-modal')">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Check Modal -->
    <div class="modal hidden" id="check-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="check-modal-title">Camera Check</h3>
                <p class="modal-subtitle" id="check-modal-subtitle"></p>
            </div>

            <div class="form-section">
                <h4>Camera Status Check</h4>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="check-working" checked>
                        <label for="check-working">Camera is working and recording</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="check-lens" checked>
                        <label for="check-lens">Lens is clean and clear</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="check-position" checked>
                        <label for="check-position">Camera position is correct</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="check-lighting" checked>
                        <label for="check-lighting">Lighting is adequate</label>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <div class="checkbox-item" style="border: 2px solid #fee2e2; background: #fef2f2;">
                    <input type="checkbox" id="issues-found">
                    <label for="issues-found" style="color: #dc2626; font-weight: 600;">Issues found</label>
                </div>
                <div class="form-group">
                    <textarea
                        id="issue-description"
                        class="form-textarea hidden"
                        rows="3"
                        placeholder="Describe the issues found..."
                        style="border-color: #fca5a5; background: #fef2f2;"></textarea>
                </div>
            </div>

            <div class="form-group">
                <label for="additional-notes" class="form-label">Additional Notes (Optional)</label>
                <textarea
                    id="additional-notes"
                    class="form-textarea"
                    rows="3"
                    placeholder="Any additional observations..."></textarea>
            </div>

            <div class="modal-actions">
                <button class="modal-button success" id="complete-check" onclick="completeCheck()">
                    Complete Check
                </button>
                <button class="modal-button secondary" onclick="closeModal('check-modal')">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Retire Camera Modal -->
    <div class="modal hidden" id="retire-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Retire Camera</h3>
                <p class="modal-subtitle" id="retire-modal-subtitle"></p>
            </div>

            <div class="form-group">
                <label for="retire-reason" class="form-label">Reason for Retirement *</label>
                <select id="retire-reason" class="form-select" required>
                    <option value="">Select reason...</option>
                    <option value="end-of-life">End of Life</option>
                    <option value="damaged">Damaged/Broken</option>
                    <option value="replaced">Replaced with New Model</option>
                    <option value="location-change">Location No Longer Needed</option>
                    <option value="other">Other</option>
                </select>
            </div>

            <div class="form-group">
                <label for="retire-notes" class="form-label">Additional Notes</label>
                <textarea
                    id="retire-notes"
                    class="form-textarea"
                    rows="3"
                    placeholder="Any additional information about the retirement..."></textarea>
            </div>

            <div class="modal-actions">
                <button class="modal-button danger" id="confirm-retire" onclick="confirmRetireCamera()">
                    Retire Camera
                </button>
                <button class="modal-button secondary" onclick="closeModal('retire-modal')">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let currentPage = 'dashboard';
        let selectedCamera = null;
        let selectedUser = null;

        // Sample camera data with full details
        let cameras = [
            {
                id: 'CAM001',
                name: 'Front Entrance Camera',
                location: 'Main Entrance - Building A',
                asset_tag: 'FS-CAM-001',
                serial_number: 'SN123456789',
                ip_address: '192.168.1.101',
                model: 'Hikvision DS-2CD2143G0-I',
                lastChecked: '2025-05-28',
                inspectionNotes: 'Previous check: lens cleaned, all functions normal',
                assignedTo: 'John Smith',
                priority: 'high',
                status: 'overdue',
                freshservice_id: '12345',
                retired: false
            },
            {
                id: 'CAM002',
                name: 'Parking Lot Camera A',
                location: 'North Parking Area',
                asset_tag: 'FS-CAM-002',
                serial_number: 'SN123456790',
                ip_address: '192.168.1.102',
                model: 'Axis P3245-LVE',
                lastChecked: '2025-05-15',
                inspectionNotes: 'Previous check: slight dirt on lens',
                assignedTo: 'John Smith',
                priority: 'medium',
                status: 'overdue',
                freshservice_id: '12346',
                retired: false
            },
            {
                id: 'CAM003',
                name: 'Loading Bay Camera',
                location: 'Service Entrance - Dock 3',
                asset_tag: 'FS-CAM-003',
                serial_number: 'SN123456791',
                ip_address: '192.168.1.103',
                model: 'Dahua IPC-HFW4431R-Z',
                lastChecked: '2025-06-02',
                inspectionNotes: 'Previous check: clear view, good condition',
                assignedTo: 'John Smith',
                priority: 'low',
                status: 'recent',
                freshservice_id: '12347',
                retired: false
            },
            {
                id: 'CAM004',
                name: 'Emergency Exit Camera',
                location: 'East Wing - Fire Exit 2',
                asset_tag: 'FS-CAM-004',
                serial_number: 'SN123456792',
                ip_address: '192.168.1.104',
                model: 'Hikvision DS-2CD2143G0-I',
                lastChecked: '2025-05-20',
                inspectionNotes: '',
                assignedTo: 'Mike Johnson',
                priority: 'high',
                status: 'overdue',
                freshservice_id: '12348',
                retired: false
            },
            {
                id: 'CAM005',
                name: 'Reception Area Camera',
                location: 'Main Lobby - Visitor Desk',
                asset_tag: 'FS-CAM-005',
                serial_number: 'SN123456793',
                ip_address: '192.168.1.105',
                model: 'Axis M3045-V',
                lastChecked: '2025-06-01',
                inspectionNotes: 'Previous check: functioning normally',
                assignedTo: 'Sarah Wilson',
                priority: 'medium',
                status: 'due-soon',
                freshservice_id: '12349',
                retired: false
            },
            {
                id: 'CAM006',
                name: 'Warehouse Camera 1',
                location: 'Warehouse Section A',
                asset_tag: 'FS-CAM-006',
                serial_number: 'SN123456794',
                ip_address: '192.168.1.106',
                model: 'Dahua IPC-HFW4431R-Z',
                lastChecked: '2025-05-30',
                inspectionNotes: 'Working well, good coverage',
                assignedTo: 'Mike Johnson',
                priority: 'medium',
                status: 'recent',
                freshservice_id: '12350',
                retired: false
            },
            {
                id: 'CAM007',
                name: 'Old Security Camera',
                location: 'Former Back Gate',
                asset_tag: 'FS-CAM-007',
                serial_number: 'SN123456795',
                ip_address: '192.168.1.107',
                model: 'Legacy Model XY-2019',
                lastChecked: '2025-04-15',
                inspectionNotes: 'Retired due to location closure',
                assignedTo: null,
                priority: 'low',
                status: 'retired',
                freshservice_id: '12351',
                retired: true
            },
            {
                id: 'CAM008',
                name: 'Damaged Parking Camera',
                location: 'South Parking (Damaged)',
                asset_tag: 'FS-CAM-008',
                serial_number: 'SN123456796',
                ip_address: '192.168.1.108',
                model: 'Hikvision DS-2CD2143G0-I',
                lastChecked: '2025-03-20',
                inspectionNotes: 'Camera damaged in storm, retired',
                assignedTo: null,
                priority: 'low',
                status: 'retired',
                freshservice_id: '12352',
                retired: true
            }
        ];

        // Sample users data
        let users = [
            {
                id: 'USER001',
                name: 'John Smith',
                email: 'john@securetech.com',
                role: 'contractor',
                company: 'SecureTech Ltd',
                status: 'active',
                lastLogin: '2025-06-04',
                phone: '+44 7700 900123'
            },
            {
                id: 'USER002',
                name: 'Sarah Wilson',
                email: 'admin@site.com',
                role: 'admin',
                company: 'Site Management',
                status: 'active',
                lastLogin: '2025-06-04',
                phone: '+44 7700 900124'
            },
            {
                id: 'USER003',
                name: 'Mike Johnson',
                email: 'mike@contractors.com',
                role: 'contractor',
                company: 'Security Solutions',
                status: 'active',
                lastLogin: '2025-06-03',
                phone: '+44 7700 900125'
            },
            {
                id: 'USER004',
                name: 'Emma Davis',
                email: 'emma@sitemanage.com',
                role: 'manager',
                company: 'Site Management',
                status: 'active',
                lastLogin: '2025-06-02',
                phone: '+44 7700 900126'
            },
            {
                id: 'USER005',
                name: 'Tom Wilson',
                email: 'tom@newcompany.com',
                role: 'contractor',
                company: 'New Security Co',
                status: 'pending',
                lastLogin: 'Never',
                phone: '+44 7700 900127'
            }
        ];

        function loginAs(role) {
            if (role === 'admin') {
                currentUser = {
                    id: 'USER002',
                    name: 'Sarah Wilson',
                    email: 'admin@site.com',
                    role: 'admin',
                    company: 'Site Management'
                };
            } else {
                currentUser = {
                    id: 'USER001',
                    name: 'John Smith',
                    email: 'john@securetech.com',
                    role: 'contractor',
                    company: 'SecureTech Ltd'
                };
            }
            
            showMainApp();
        }

        function showMainApp() {
            document.getElementById('login-page').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            
            updateUserInterface();
            updateNavigation();
            updateStats();
            renderContent();
        }

        function logout() {
            currentUser = null;
            document.getElementById('main-app').classList.add('hidden');
            document.getElementById('login-page').classList.remove('hidden');
        }

        function updateUserInterface() {
            document.getElementById('current-user-name').textContent = currentUser.name;
            document.getElementById('current-user-role').textContent = currentUser.role.toUpperCase();
            document.getElementById('current-user-avatar').textContent = currentUser.name.split(' ').map(n => n[0]).join('');
            
            const roleClass = currentUser.role === 'admin' ? 'admin-badge' : 'contractor-badge';
            document.getElementById('current-user-role').className = `user-role-badge ${roleClass}`;
        }

        function updateNavigation() {
            if (currentUser.role === 'admin') {
                document.getElementById('contractor-nav').classList.add('hidden');
                document.getElementById('admin-nav').classList.remove('hidden');
                document.getElementById('app-title').textContent = 'CCTV Admin Portal';
                navigateTo('admin-dashboard');
            } else {
                document.getElementById('admin-nav').classList.add('hidden');
                document.getElementById('contractor-nav').classList.remove('hidden');
                document.getElementById('app-title').textContent = 'CCTV Contractor Portal';
                navigateTo('dashboard');
            }
        }

        function updateStats() {
            const today = new Date().toISOString().split('T')[0];
            const activeCameras = cameras.filter(c => !c.retired);
            
            if (currentUser.role === 'contractor') {
                const assigned = activeCameras.filter(c => c.assignedTo === currentUser.name).length;
                const checkedToday = activeCameras.filter(c => c.lastChecked === today && c.assignedTo === currentUser.name).length;
                const overdue = activeCameras.filter(c => c.status === 'overdue' && c.assignedTo === currentUser.name).length;
                
                document.getElementById('stat-assigned').textContent = assigned;
                document.getElementById('stat-checked').textContent = checkedToday;
                document.getElementById('stat-overdue').textContent = overdue;
                
                document.getElementById('nav-assigned-count').textContent = assigned;
                document.getElementById('nav-overdue-count').textContent = overdue;
                document.getElementById('nav-completed-count').textContent = checkedToday;
            } else {
                const totalCameras = cameras.length;
                const activeCount = activeCameras.length;
                const retiredCount = cameras.filter(c => c.retired).length;
                const overdue = activeCameras.filter(c => c.status === 'overdue').length;
                
                document.getElementById('admin-stat-cameras').textContent = totalCameras;
                document.getElementById('admin-stat-active').textContent = activeCount;
                document.getElementById('admin-stat-overdue').textContent = overdue;
                document.getElementById('admin-stat-retired').textContent = retiredCount;
                
                document.getElementById('nav-total-cameras').textContent = totalCameras;
                document.getElementById('nav-total-users').textContent = users.length;
            }
        }

        function navigateTo(page) {
            document.querySelectorAll('[id$="-page"]').forEach(p => p.classList.add('hidden'));
            document.getElementById(page + '-page').classList.remove('hidden');
            
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            currentPage = page;
            renderContent();
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('main-content');
            
            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('open');
            } else {
                sidebar.classList.toggle('collapsed');
                mainContent.classList.toggle('expanded');
            }
        }

        function renderContent() {
            switch(currentPage) {
                case 'dashboard':
                case 'admin-dashboard':
                case 'camera-management':
                case 'my-cameras':
                case 'overdue':
                case 'completed':
                    renderCameras();
                    break;
                case 'all-cameras':
                    renderCamerasTable();
                    break;
                case 'users':
                    renderUsersTable();
                    break;
                case 'issues':
                case 'all-checks':
                case 'history':
                case 'analytics':
                case 'locations':
                case 'freshservice-sync':
                case 'settings':
                case 'permissions':
                    // These pages have static content, no rendering needed
                    break;
            }
        }

        function renderCameras() {
            const today = new Date().toISOString().split('T')[0];
            let filteredCameras = cameras;
            let containerId = 'cameras-grid';
            
            switch(currentPage) {
                case 'dashboard':
                    if (currentUser.role === 'contractor') {
                        filteredCameras = cameras.filter(c => c.assignedTo === currentUser.name && !c.retired);
                        containerId = 'cameras-grid';
                    } else {
                        filteredCameras = cameras.filter(c => !c.retired);
                        containerId = 'admin-cameras-grid';
                    }
                    break;
                case 'admin-dashboard':
                    filteredCameras = cameras.filter(c => !c.retired);
                    containerId = 'admin-cameras-grid';
                    break;
                case 'camera-management':
                    filteredCameras = cameras;
                    containerId = 'camera-management-grid';
                    break;
                case 'my-cameras':
                    filteredCameras = cameras.filter(c => c.assignedTo === currentUser.name && !c.retired);
                    containerId = 'my-cameras-grid';
                    break;
                case 'overdue':
                    filteredCameras = cameras.filter(c => {
                        const isOverdue = c.status === 'overdue' && !c.retired;
                        return currentUser.role === 'admin' ? isOverdue : (isOverdue && c.assignedTo === currentUser.name);
                    });
                    containerId = 'overdue-grid';
                    break;
                case 'completed':
                    filteredCameras = cameras.filter(c => {
                        const isCheckedToday = c.lastChecked === today && !c.retired;
                        return currentUser.role === 'admin' ? isCheckedToday : (isCheckedToday && c.assignedTo === currentUser.name);
                    });
                    containerId = 'completed-grid';
                    break;
            }
            
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = filteredCameras.map(camera => createCameraCard(camera)).join('');
        }

        function createCameraCard(camera) {
            const today = new Date().toISOString().split('T')[0];
            const isCheckedToday = camera.lastChecked === today;
            const canCheck = !camera.retired && ((currentUser.role === 'admin') || (currentUser.role === 'contractor' && camera.assignedTo === currentUser.name && !isCheckedToday));
            const isAdmin = currentUser.role === 'admin';
            
            return `
                <div class="camera-card ${camera.retired ? 'opacity-60' : ''}">
                    <div class="camera-header">
                        <div class="camera-info">
                            <div class="camera-title">
                                <span style="font-size: 18px;">üì∑</span>
                                <h3>${camera.name}</h3>
                            </div>
                            <div class="camera-location">
                                <span style="font-size: 12px; margin-right: 4px;">üìç</span>
                                <span>${camera.location}</span>
                            </div>
                            <div class="camera-badges">
                                ${getStatusBadge(camera)}
                                ${getPriorityBadge(camera.priority)}
                                ${camera.retired ? '<span class="badge badge-retired">RETIRED</span>' : ''}
                            </div>
                        </div>
                        <div class="camera-status">
                            ${getStatusIcon(camera)}
                        </div>
                    </div>
                    
                    <div class="camera-details">
                        <div class="detail-row">
                            <span class="detail-label">Serial:</span>
                            <span class="detail-value">${camera.serial_number}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">IP Address:</span>
                            <span class="detail-value">${camera.ip_address}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Last Checked:</span>
                            <span class="detail-value ${camera.status === 'overdue' ? 'overdue' : ''}">
                                ${camera.lastChecked ? formatDate(camera.lastChecked) : 'Never'}
                            </span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Assigned To:</span>
                            <span class="detail-value">${camera.assignedTo || 'Unassigned'}</span>
                        </div>
                        ${camera.inspectionNotes ? `
                            <div>
                                <span class="detail-label">Previous Notes:</span>
                                <div class="previous-notes">${camera.inspectionNotes}</div>
                            </div>
                        ` : ''}
                    </div>
                    
                    ${!camera.retired && canCheck ? `
                        <button class="check-button enabled" onclick="performCheck('${camera.id}')">
                            Perform Check
                        </button>
                    ` : `
                        <button class="check-button disabled" disabled>
                            ${camera.retired ? 'Camera Retired' : (isCheckedToday ? 'Already Checked Today' : 'Not Available')}
                        </button>
                    `}
                    
                    ${isAdmin ? `
                        <div class="admin-actions">
                            <button class="admin-btn edit" onclick="editCamera('${camera.id}')">
                                ‚úèÔ∏è Edit
                            </button>
                            ${!camera.retired ? `
                                <button class="admin-btn retire" onclick="retireCamera('${camera.id}')">
                                    üóëÔ∏è Retire
                                </button>
                            ` : `
                                <button class="admin-btn" onclick="reactivateCamera('${camera.id}')" style="border-color: #059669; color: #059669;">
                                    üîÑ Reactivate
                                </button>
                            `}
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderCamerasTable() {
            const tbody = document.getElementById('cameras-table-body');
            if (!tbody) return;
            
            tbody.innerHTML = cameras.map(camera => `
                <tr style="background: ${camera.retired ? '#f8f9fa' : 'white'};">
                    <td style="font-weight: 500;">${camera.name}</td>
                    <td>${camera.location}</td>
                    <td style="font-family: monospace; font-size: 12px;">${camera.serial_number}</td>
                    <td style="font-family: monospace; font-size: 12px;">${camera.ip_address}</td>
                    <td>${camera.assignedTo || 'Unassigned'}</td>
                    <td>
                        ${camera.retired ? '<span class="badge badge-retired">RETIRED</span>' : getStatusBadge(camera)}
                    </td>
                    <td>${camera.lastChecked ? formatDate(camera.lastChecked) : 'Never'}</td>
                    <td>
                        <div class="table-actions">
                            <button class="table-action-btn edit" onclick="editCamera('${camera.id}')" title="Edit">
                                ‚úèÔ∏è
                            </button>
                            ${!camera.retired ? `
                                <button class="table-action-btn retire" onclick="retireCamera('${camera.id}')" title="Retire">
                                    üóëÔ∏è
                                </button>
                            ` : `
                                <button class="table-action-btn" onclick="reactivateCamera('${camera.id}')" title="Reactivate" style="color: #059669;">
                                    üîÑ
                                </button>
                            `}
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function renderUsersTable() {
            const tbody = document.getElementById('users-table-body');
            if (!tbody) return;
            
            tbody.innerHTML = users.map(user => `
                <tr>
                    <td style="font-weight: 500;">${user.name}</td>
                    <td>${user.email}</td>
                    <td>
                        <span style="padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: 600; ${getRoleStyle(user.role)}">
                            ${user.role.toUpperCase()}
                        </span>
                    </td>
                    <td>${user.company || '-'}</td>
                    <td>
                        <span style="padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: 600; ${getStatusStyle(user.status)}">
                            ${user.status.toUpperCase()}
                        </span>
                    </td>
                    <td>${user.lastLogin !== 'Never' ? formatDate(user.lastLogin) : 'Never'}</td>
                    <td>
                        <div class="table-actions">
                            <button class="table-action-btn edit" onclick="editUser('${user.id}')" title="Edit">
                                ‚úèÔ∏è
                            </button>
                            <button class="table-action-btn retire" onclick="deleteUser('${user.id}')" title="Delete">
                                üóëÔ∏è
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Camera management functions
        function addNewCamera() {
            selectedCamera = null;
            document.getElementById('camera-modal-title').textContent = 'Add New Camera';
            document.getElementById('camera-form').reset();
            document.getElementById('camera-priority').value = 'medium';
            document.getElementById('camera-modal').classList.remove('hidden');
        }

        function editCamera(cameraId) {
            selectedCamera = cameras.find(c => c.id === cameraId);
            if (!selectedCamera) return;
            
            document.getElementById('camera-modal-title').textContent = 'Edit Camera';
            document.getElementById('camera-name').value = selectedCamera.name;
            document.getElementById('camera-asset-tag').value = selectedCamera.asset_tag;
            document.getElementById('camera-location').value = selectedCamera.location;
            document.getElementById('camera-serial').value = selectedCamera.serial_number;
            document.getElementById('camera-ip').value = selectedCamera.ip_address;
            document.getElementById('camera-model').value = selectedCamera.model;
            document.getElementById('camera-assigned').value = selectedCamera.assignedTo || '';
            document.getElementById('camera-priority').value = selectedCamera.priority;
            document.getElementById('camera-notes').value = selectedCamera.inspectionNotes;
            document.getElementById('camera-id').value = selectedCamera.id;
            document.getElementById('freshservice-id').value = selectedCamera.freshservice_id;
            
            document.getElementById('camera-modal').classList.remove('hidden');
        }

        function saveCamera() {
            const form = document.getElementById('camera-form');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            const cameraData = {
                name: document.getElementById('camera-name').value,
                asset_tag: document.getElementById('camera-asset-tag').value,
                location: document.getElementById('camera-location').value,
                serial_number: document.getElementById('camera-serial').value,
                ip_address: document.getElementById('camera-ip').value,
                model: document.getElementById('camera-model').value,
                assignedTo: document.getElementById('camera-assigned').value || null,
                priority: document.getElementById('camera-priority').value,
                inspectionNotes: document.getElementById('camera-notes').value
            };
            
            if (selectedCamera) {
                // Update existing camera
                Object.assign(selectedCamera, cameraData);
            } else {
                // Add new camera
                const newCamera = {
                    id: 'CAM' + String(cameras.length + 1).padStart(3, '0'),
                    ...cameraData,
                    lastChecked: null,
                    status: 'pending',
                    freshservice_id: null,
                    retired: false
                };
                cameras.push(newCamera);
            }
            
            closeModal('camera-modal');
            updateStats();
            renderContent();
            
            alert(`Camera ${selectedCamera ? 'updated' : 'added'} successfully!`);
        }

        function retireCamera(cameraId) {
            selectedCamera = cameras.find(c => c.id === cameraId);
            if (!selectedCamera) return;
            
            document.getElementById('retire-modal-subtitle').textContent = `Retire: ${selectedCamera.name}`;
            document.getElementById('retire-reason').value = '';
            document.getElementById('retire-notes').value = '';
            document.getElementById('retire-modal').classList.remove('hidden');
        }

        function confirmRetireCamera() {
            const reason = document.getElementById('retire-reason').value;
            const notes = document.getElementById('retire-notes').value;
            
            if (!reason) {
                alert('Please select a reason for retirement.');
                return;
            }
            
            selectedCamera.retired = true;
            selectedCamera.status = 'retired';
            selectedCamera.assignedTo = null;
            selectedCamera.inspectionNotes = `RETIRED: ${reason}. ${notes}`;
            
            closeModal('retire-modal');
            updateStats();
            renderContent();
            
            alert(`Camera "${selectedCamera.name}" has been retired.`);
        }

        function reactivateCamera(cameraId) {
            if (confirm('Are you sure you want to reactivate this camera?')) {
                const camera = cameras.find(c => c.id === cameraId);
                if (camera) {
                    camera.retired = false;
                    camera.status = 'pending';
                    updateStats();
                    renderContent();
                    alert(`Camera "${camera.name}" has been reactivated.`);
                }
            }
        }

        // User management functions
        function addNewUser() {
            selectedUser = null;
            document.getElementById('user-modal-title').textContent = 'Add New User';
            document.getElementById('user-form').reset();
            document.getElementById('user-status').value = 'active';
            document.getElementById('user-modal').classList.remove('hidden');
        }

        function editUser(userId) {
            selectedUser = users.find(u => u.id === userId);
            if (!selectedUser) return;
            
            document.getElementById('user-modal-title').textContent = 'Edit User';
            document.getElementById('user-name').value = selectedUser.name;
            document.getElementById('user-email').value = selectedUser.email;
            document.getElementById('user-role').value = selectedUser.role;
            document.getElementById('user-company').value = selectedUser.company;
            document.getElementById('user-phone').value = selectedUser.phone;
            document.getElementById('user-status').value = selectedUser.status;
            document.getElementById('user-id').value = selectedUser.id;
            
            document.getElementById('user-modal').classList.remove('hidden');
        }

        function saveUser() {
            const form = document.getElementById('user-form');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            const userData = {
                name: document.getElementById('user-name').value,
                email: document.getElementById('user-email').value,
                role: document.getElementById('user-role').value,
                company: document.getElementById('user-company').value,
                phone: document.getElementById('user-phone').value,
                status: document.getElementById('user-status').value
            };
            
            if (selectedUser) {
                Object.assign(selectedUser, userData);
            } else {
                const newUser = {
                    id: 'USER' + String(users.length + 1).padStart(3, '0'),
                    ...userData,
                    lastLogin: 'Never'
                };
                users.push(newUser);
            }
            
            closeModal('user-modal');
            updateStats();
            renderContent();
            
            alert(`User ${selectedUser ? 'updated' : 'added'} successfully!`);
        }

        function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this user?')) {
                users = users.filter(u => u.id !== userId);
                updateStats();
                renderContent();
                alert('User deleted successfully!');
            }
        }

        // Check functions
        function performCheck(cameraId) {
            selectedCamera = cameras.find(c => c.id === cameraId);
            if (!selectedCamera) return;
            
            document.getElementById('check-modal-title').textContent = `Check: ${selectedCamera.name}`;
            document.getElementById('check-modal-subtitle').textContent = selectedCamera.location;
            
            document.getElementById('check-working').checked = true;
            document.getElementById('check-lens').checked = true;
            document.getElementById('check-position').checked = true;
            document.getElementById('check-lighting').checked = true;
            document.getElementById('issues-found').checked = false;
            document.getElementById('issue-description').value = '';
            document.getElementById('additional-notes').value = '';
            document.getElementById('issue-description').classList.add('hidden');
            
            document.getElementById('check-modal').classList.remove('hidden');
        }

        function completeCheck() {
            if (!selectedCamera) return;
            
            const working = document.getElementById('check-working').checked;
            const lens = document.getElementById('check-lens').checked;
            const position = document.getElementById('check-position').checked;
            const lighting = document.getElementById('check-lighting').checked;
            const issuesFound = document.getElementById('issues-found').checked;
            const issueDescription = document.getElementById('issue-description').value;
            const additionalNotes = document.getElementById('additional-notes').value;
            
            if (!working || !lens || !position || !lighting) {
                alert('All status checks must be completed.');
                return;
            }
            
            if (issuesFound && !issueDescription.trim()) {
                alert('Please describe the issues found.');
                return;
            }
            
            const today = new Date().toISOString().split('T')[0];
            let notes = additionalNotes.trim();
            if (issuesFound && issueDescription.trim()) {
                notes += (notes ? ' - ' : '') + `ISSUES: ${issueDescription.trim()}`;
            }
            
            selectedCamera.lastChecked = today;
            selectedCamera.inspectionNotes = notes || 'Check completed - no issues reported';
            selectedCamera.status = 'checked';
            
            closeModal('check-modal');
            updateStats();
            renderContent();
            
            alert(`Check completed successfully for ${selectedCamera.name}`);
        }

        // Utility functions
        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
            selectedCamera = null;
            selectedUser = null;
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('en-GB');
        }

        function getStatusBadge(camera) {
            const today = new Date().toISOString().split('T')[0];
            if (camera.retired) {
                return '<span class="badge badge-retired">RETIRED</span>';
            } else if (camera.lastChecked === today) {
                return '<span class="badge badge-checked">Checked Today</span>';
            } else if (camera.status === 'overdue') {
                return '<span class="badge badge-overdue">Overdue</span>';
            } else if (camera.status === 'recent') {
                return '<span class="badge badge-recent">Recent</span>';
            } else {
                return '<span class="badge badge-due-soon">Due Soon</span>';
            }
        }

        function getPriorityBadge(priority) {
            const classes = {
                'high': 'badge-high',
                'medium': 'badge-medium',
                'low': 'badge-low'
            };
            return `<span class="badge badge-priority ${classes[priority]}">${priority.toUpperCase()}</span>`;
        }

        function getStatusIcon(camera) {
            const today = new Date().toISOString().split('T')[0];
            if (camera.retired) {
                return '<span style="color: #6b7280; font-size: 20px;">‚ö´</span>';
            } else if (camera.lastChecked === today) {
                return '<span style="color: #059669; font-size: 20px;">‚úÖ</span>';
            } else if (camera.status === 'overdue') {
                return '<span style="color: #dc2626; font-size: 20px;">‚ö†Ô∏è</span>';
            } else {
                return '<span style="color: #f59e0b; font-size: 20px;">üïê</span>';
            }
        }

        function getRoleStyle(role) {
            switch(role) {
                case 'admin': return 'background: #fee2e2; color: #991b1b;';
                case 'manager': return 'background: #fef3c7; color: #92400e;';
                case 'contractor': return 'background: #dbeafe; color: #1e40af;';
                default: return 'background: #f3f4f6; color: #374151;';
            }
        }

        function getStatusStyle(status) {
            switch(status) {
                case 'active': return 'background: #dcfce7; color: #166534;';
                case 'inactive': return 'background: #fee2e2; color: #991b1b;';
                case 'pending': return 'background: #fef3c7; color: #92400e;';
                default: return 'background: #f3f4f6; color: #374151;';
            }
        }

        // Search and filter functions
        function filterCameraTable() {
            const searchTerm = document.getElementById('camera-search').value.toLowerCase();
            const rows = document.querySelectorAll('#cameras-table-body tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                const matches = text.includes(searchTerm);
                row.style.display = matches ? '' : 'none';
            });
        }

        function filterUserTable() {
            const searchTerm = document.getElementById('user-search').value.toLowerCase();
            const rows = document.querySelectorAll('#users-table-body tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                const matches = text.includes(searchTerm);
                row.style.display = matches ? '' : 'none';
            });
        }

        // System functions
        function syncWithFreshservice() {
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<span>üîÑ</span>Syncing...';
            button.disabled = true;
            
            // Simulate API call
            setTimeout(() => {
                button.innerHTML = originalText;
                button.disabled = false;
                alert('Successfully synced with Freshservice! 3 cameras updated.');
                updateStats();
                renderContent();
            }, 2000);
        }

        function exportCameraData() {
            // Create CSV data
            const headers = ['Name', 'Location', 'Serial Number', 'IP Address', 'Model', 'Assigned To', 'Status', 'Last Checked'];
            const csvData = cameras.map(camera => [
                camera.name,
                camera.location,
                camera.serial_number,
                camera.ip_address,
                camera.model,
                camera.assignedTo || 'Unassigned',
                camera.retired ? 'Retired' : camera.status,
                camera.lastChecked || 'Never'
            ]);
            
            const csvContent = [headers, ...csvData]
                .map(row => row.map(field => `"${field}"`).join(','))
                .join('\n');
            
            // Download CSV
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `camera_inventory_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function exportCheckReports() {
            // Create CSV data for check reports
            const headers = ['Date', 'Camera', 'Inspector', 'Status', 'Issues', 'Notes'];
            const csvData = [
                ['04/06/2025', 'Reception Area Camera', 'Sarah Wilson', 'PASS', 'None', 'Functioning normally'],
                ['03/06/2025', 'Loading Bay Camera', 'John Smith', 'PASS', 'None', 'Clear view, good condition'],
                ['02/06/2025', 'Front Entrance Camera', 'John Smith', 'ISSUES', 'Lens dirty', 'ISSUES: Lens requires cleaning'],
                ['01/06/2025', 'Warehouse Camera 1', 'Mike Johnson', 'PASS', 'None', 'Working well, good coverage']
            ];
            
            const csvContent = [headers, ...csvData]
                .map(row => row.map(field => `"${field}"`).join(','))
                .join('\n');
            
            // Download CSV
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `check_reports_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Issues checkbox handler
            document.getElementById('issues-found').addEventListener('change', function() {
                const issueDescription = document.getElementById('issue-description');
                if (this.checked) {
                    issueDescription.classList.remove('hidden');
                    issueDescription.required = true;
                } else {
                    issueDescription.classList.add('hidden');
                    issueDescription.required = false;
                    issueDescription.value = '';
                }
            });

            // Close modals when clicking outside
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.add('hidden');
                    }
                });
            });

            // Responsive sidebar
            window.addEventListener('resize', function() {
                if (window.innerWidth > 768) {
                    document.getElementById('sidebar').classList.remove('open');
                }
            });
        });

        // Make functions globally available
        window.loginAs = loginAs;
        window.logout = logout;
        window.navigateTo = navigateTo;
        window.toggleSidebar = toggleSidebar;
        window.performCheck = performCheck;
        window.completeCheck = completeCheck;
        window.closeModal = closeModal;
        window.addNewCamera = addNewCamera;
        window.editCamera = editCamera;
        window.saveCamera = saveCamera;
        window.retireCamera = retireCamera;
        window.confirmRetireCamera = confirmRetireCamera;
        window.reactivateCamera = reactivateCamera;
        window.addNewUser = addNewUser;
        window.editUser = editUser;
        window.saveUser = saveUser;
        window.deleteUser = deleteUser;
        window.syncWithFreshservice = syncWithFreshservice;
        window.exportCameraData = exportCameraData;
        window.exportCheckReports = exportCheckReports;
        window.filterCameraTable = filterCameraTable;
        window.filterUserTable = filterUserTable;
    </script>
</body>
</html>
